<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Login/Register - HomeChef</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 50px auto; padding: 20px; }
    .form-section { background: #f8f9fa; padding: 30px; border-radius: 10px; margin: 20px 0; }
    input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; }
    button { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
    button:hover { background: #0056b3; }
    .message { padding: 15px; margin: 15px 0; border-radius: 5px; }
    .success { background: #d4edda; color: #155724; }
    .error { background: #f8d7da; color: #721c24; }
    .info { background: #d1ecf1; color: #0c5460; }
  </style>
</head>
<body>
  <h1>üç≥ HomeChef - Test Login/Register</h1>
  
  <!-- Register Form -->
  <div class="form-section">
    <h3>Register New User</h3>
    <input type="text" id="regName" placeholder="Full Name" value="Test User">
    <input type="email" id="regEmail" placeholder="Email" value="test@example.com">
    <input type="password" id="regPassword" placeholder="Password" value="password123">
    <button onclick="testRegister()">Register</button>
    <div id="regMessage" class="message" style="display: none;"></div>
  </div>

  <!-- Login Form -->
  <div class="form-section">
    <h3>Login User</h3>
    <input type="email" id="loginEmail" placeholder="Email" value="john@test.com">
    <input type="password" id="loginPassword" placeholder="Password" value="password123">
    <button onclick="testLogin()">Login</button>
    <div id="loginMessage" class="message" style="display: none;"></div>
  </div>

  <!-- Test Existing Users -->
  <div class="form-section">
    <h3>Test with Existing Users</h3>
    <p>Try these existing test accounts:</p>
    <ul>
      <li>Email: john@test.com | Password: password123</li>
      <li>Email: jane@test.com | Password: password123</li>
      <li>Email: mike@test.com | Password: password123</li>
    </ul>
  </div>

  <script>
    const API_BASE = 'http://localhost:3002/api';

    function showMessage(elementId, message, type) {
      const element = document.getElementById(elementId);
      element.textContent = message;
      element.className = `message ${type}`;
      element.style.display = 'block';
    }

    async function testRegister() {
      console.log('Register button clicked!');
      
      const userData = {
        name: document.getElementById('regName').value,
        email: document.getElementById('regEmail').value,
        password: document.getElementById('regPassword').value
      };

      console.log('Sending registration data:', userData);
      showMessage('regMessage', 'Registering user...', 'info');

      try {
        const response = await fetch(`${API_BASE}/users/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(userData)
        });
        
        const data = await response.json();
        console.log('Registration response:', data);
        
        if (response.ok) {
          showMessage('regMessage', `‚úÖ Registration successful! User ID: ${data.user?.id || 'N/A'}`, 'success');
        } else {
          showMessage('regMessage', `‚ùå Registration failed: ${data.message || 'Unknown error'}`, 'error');
        }
      } catch (error) {
        console.error('Registration error:', error);
        showMessage('regMessage', `‚ùå Network error: ${error.message}`, 'error');
      }
    }

    async function testLogin() {
      console.log('Login button clicked!');
      
      const credentials = {
        email: document.getElementById('loginEmail').value,
        password: document.getElementById('loginPassword').value
      };

      console.log('Sending login data:', credentials);
      showMessage('loginMessage', 'Logging in...', 'info');

      try {
        const response = await fetch(`${API_BASE}/users/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(credentials)
        });
        
        const data = await response.json();
        console.log('Login response:', data);
        
        if (response.ok) {
          showMessage('loginMessage', `‚úÖ Login successful! Welcome ${data.user?.name || 'User'}`, 'success');
        } else {
          showMessage('loginMessage', `‚ùå Login failed: ${data.message || 'Invalid credentials'}`, 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showMessage('loginMessage', `‚ùå Network error: ${error.message}`, 'error');
      }
    }

    // Test if backend is running
    async function testBackend() {
      try {
        const response = await fetch(`${API_BASE.replace('/api', '')}/`);
        const data = await response.json();
        console.log('‚úÖ Backend is running:', data);
      } catch (error) {
        console.error('‚ùå Backend not accessible:', error.message);
        alert('Backend server is not running! Please start it first.');
      }
    }

    // Test backend on page load
    window.onload = testBackend;
  </script>
</body>
</html>